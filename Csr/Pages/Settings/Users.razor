@page "/settings/users"
@inject CsrDbContext ctx

<p>
    <a href="/settings/adduser">Add User</a>
</p>

@if (UserList == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table table-striped table-hover">
        <thead>
            <tr class="text-center">
                <th>UserID</th>
                <th>UserName</th>
                <th></th>
            </tr>

        </thead>
        <tbody>
            @foreach (var item in UserList)
            {
                <tr class="text-center">
                    <td>@item.UserID</td>
                    <td>@item.UserName</td>
                    <td>
                        <a href="/settings/edituser/@item.UserID">Edit</a>
                        <a href="/settings/edituser/@item.UserID">Delete</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
<br />

<MudTable Items="@Users1" Dense="@dense" Hover="@hover" Bordered="@bordered" Striped="@striped" Filter="new Func<User,bool>(FilterFunc1)" @bind-SelectedItem="selectedItem1">
    <ToolBarContent>
        <MudText Typo="Typo.h6">UserList</MudText>
        <MudSpacer />
        <MudTextField @bind-Value="searchString1" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>
    <HeaderContent>
        <MudTh Class="text-center">UserID</MudTh>
        <MudTh Class="text-center">UserName</MudTh>
        <MudTh Class="text-center"></MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd Class="text-center" DataLabel="UserID">@context.UserID</MudTd>
        <MudTd Class="text-center" DataLabel="UserName">@context.UserName</MudTd>
        <MudTd Class="text-center">
            <a href="/settings/edituser/@context.UserID">Edit</a>
            <a href="/settings/edituser/@context.UserID">Delete</a>
        </MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>



@code {
    public List<User> UserList { get; set; }

    
    private bool dense = true;
    private bool hover = true;
    private bool striped = true;
    private bool bordered = false;
    private string searchString1 = "";
    private string searchString2 = "";

    private User selectedItem1 = null;
    private User selectedItem2 = null;

    private HashSet<User> selectedItems = new HashSet<User>();

    private IEnumerable<User> Users1 = new List<User>();

    protected override async Task OnInitializedAsync()
    {
        UserList = await ctx.Users.ToListAsync();
        Users1 = await ctx.Users.ToListAsync();

    }

    private bool FilterFunc1(User user) => FilterFunc(user, searchString1);
    private bool FilterFunc2(User user) => FilterFunc(user, searchString2);

    private bool FilterFunc(User user, string searchString)
    {
        if (string.IsNullOrWhiteSpace(searchString))
            return true;
        if (user.UserID.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (user.UserName.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if ($"{user.UserID} {user.UserName}".Contains(searchString))
            return true;
        return false;
    }
}
